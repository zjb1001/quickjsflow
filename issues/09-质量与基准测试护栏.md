# 质量与基准测试护栏

## 需求
建立全面的质量保障体系，包括持续集成（CI）、代码覆盖率、性能基准测试（Benchmark）和模糊测试（Fuzzing）。
目标是确保引擎在功能正确的同时，具备高性能和高稳定性。

## Issue 元数据
- 类型：Task（基础设施）
- 标签：ci, testing, benchmark, quality, mvp
- 负责人：@page

## 📁 项目结构与开发环境

参考根目录 [issues/00-完整Issue清单与执行计划.md](00-完整Issue清单与执行计划.md) 的**项目结构**与**构建与测试命令**章节。关键路径：
- 测试框架：`test/test_framework.h`（C 宏，已就位）
- 测试套件：`test/` 目录汇聚各模块测试（15 个测试通过）
- 构建命令：`make test` 编译并运行所有集成测试
- CI 配置：`.github/workflows/` （待添加）
- 当前状态：单层测试框架已建立，覆盖率/性能基准工具待集成
- 目标：✅ CI 全绿、≥80% 覆盖率、性能基线报告

- 依赖：Issue 11（集成测试）
- 目标版本：v0.1.0（MVP）

## 技术要点

### 1. 自动化测试与 CI
- **框架**：Vitest 或 Jest。
- **CI 工具**：GitHub Actions。
- **流程**：Push/PR -> Lint (ESLint) -> Type Check (TSC) -> Unit Tests -> Integration Tests -> Build。

### 2. 代码覆盖率（Code Coverage）
- **工具**：C8 / Istanbul。
- **目标**：
  - 全局覆盖率 > 80%。
  - 核心模块（Lexer/Parser/Scope）覆盖率 > 90%。
- **报告**：集成 Codecov 或直接在 PR 中展示。

### 3. 性能基准测试（Benchmarks）
- **对比对象**：Acorn, Babel, Meriyah。
- **指标**：
  - **Parsing Speed** (MB/s)：解析 React/Vue/TypeScript 源码。
  - **Memory Usage** (MB)：AST 内存占用。
- **工具**：Benchmark.js 或 Tinybench。
- **场景**：
  - 小文件（Config files）
  - 中型文件（Libraries like jQuery）
  - 大文件（Bundle files > 1MB）

### 4. 模糊测试（Fuzz Testing）
- 使用 `eslump` 或自定义 fuzzer 生成随机 JS 代码。
- 验证 Parser 不会 Crash（即使输入非法）。
- 验证 Round-trip 一致性（针对合法生成的代码）。

## 交付物
- ⚙️ `.github/workflows` 配置文件
- 📊 Benchmark 脚本与基线报告
- 🛡️ 覆盖率报告配置
- 🐛 Fuzzing 脚本

## 任务清单
- [ ] 配置 ESLint, Prettier, TypeScript。
- [ ] 配置 GitHub Actions (CI)。
- [ ] 编写 Benchmark 脚本，选取 3-5 个典型库作为样本。
- [ ] 集成覆盖率工具，设定阈值。
- [ ] 建立 Fuzzing 机制，每天定时运行。

## 验收标准
- ✅ CI 流程稳定运行，能在 5 分钟内反馈结果。
- ✅ 核心模块测试覆盖率达标。
- ✅ 性能不低于 Babel（作为基线）。
- ✅ Fuzzing 连续运行 24 小时无 Crash。

## 优先级
🔴 **MVP**（伴随开发全程）

